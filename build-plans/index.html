<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Build Plans - Box</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">Box</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Intro</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">Build Plans</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../user-guide/cli/">Command-Line Options</a>
</li>

                    
                        
<li >
    <a href="../user-guide/verbs/">Verbs</a>
</li>

                    
                        
<li >
    <a href="../user-guide/functions/">Functions</a>
</li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="..">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../user-guide/cli/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/erikh/box">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#box-build-plans-are-programs">Box Build Plans are Programs</a></li>
        
    
        <li class="main "><a href="#powered-by-mruby">Powered by mruby</a></li>
        
    
        <li class="main "><a href="#tagging-and-image-editing">Tagging and Image Editing</a></li>
        
    
        <li class="main "><a href="#the-debugger">The Debugger</a></li>
        
    
        <li class="main "><a href="#verb-properties">Verb Properties</a></li>
        
    
        <li class="main "><a href="#experiment-with-the-repl">Experiment with the REPL</a></li>
        
    
        <li class="main "><a href="#parallel-building">Parallel Building</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<p>Build Plans power Box and are the core of its functionality. This
document describes how you can power box by writing build plans, and
what techniques to use while writing them.</p>
<h2 id="box-build-plans-are-programs">Box Build Plans are Programs</h2>
<p>Exploit this! Use functions! Save variables and constants!</p>
<p>run this plan with: <code>GOLANG_VERSION=1.7.5 box &lt;plan file&gt;</code></p>
<pre><code class="ruby">from &quot;ubuntu&quot;

# this function will create a new layer running the command inside the
# function, installing the required package.
def install_package(pkg)
  run &quot;apt-get install '#{pkg}' -y&quot;
end

run &quot;apt-get update&quot;
install_package &quot;curl&quot; # `run &quot;apt-get install curl -y&quot;`

# get the local environment's setting for GOLANG_VERSION, and set it here:
go_version = getenv(&quot;GOLANG_VERSION&quot;)
run %Q[curl -sSL \
    https://storage.googleapis.com/golang/go#{go_version}.linux-amd64.tar.gz \
    | tar -xvz -C /usr/local]
</code></pre>

<h2 id="powered-by-mruby">Powered by mruby</h2>
<p>Box uses the <a href="https://mruby.org/">mruby programming language</a>. It does
this to get a solid language syntax, functions, variables and more.
However, it is not a fully featured Ruby such as MRI and contains almost
zero standard library functionality, allowing for only the basic types,
and no I/O operations outside of the box DSL are permitted.</p>
<p>You can however:</p>
<ul>
<li>Define classes, functions, variables and constants</li>
<li>Access the environment through the
  <a href="../user-guide/functions/#getenv">getenv</a> box function (which is also
  <a href="../user-guide/cli/#-omit-o">omittable</a> if you don't want people to use
  it)</li>
<li>Retrieve the contents of container files with <a href="../user-guide/functions/#read">read</a></li>
<li><a href="../user-guide/functions/#import">import</a> libraries (also written in
  mruby) to re-use common build plan components.</li>
</ul>
<h2 id="tagging-and-image-editing">Tagging and Image Editing</h2>
<p>You can tag images mid-plan to create multiple images, each subsets (or
supersets, depending on how you look at it) of each other.</p>
<p>Additionally, you can use functions like
<a href="../user-guide/verbs/#after">after</a>, <a href="../user-guide/functions/#skip">skip</a>,
and <a href="../user-guide/verbs/#flatten">flatten</a> to manipulate images in ways
you may not have considered:</p>
<pre><code class="ruby">from :ubuntu
skip do
  run &quot;apt-get update&quot;
  run &quot;apt-get install curl -y&quot;
  run &quot;curl -sSL -O https://github.com/erikh/box/releases/download/v0.4.2/box_0.4.2_amd64.deb&quot;
  tag :downloaded
end

run &quot;dpkg -i box*.deb&quot;
after do
  flatten
  tag :installed
end
</code></pre>

<p>Because the tag is processed after the final edits occur, tag
<code>installed</code> will not contain the update manifests, <code>curl</code>, or the
<code>.deb</code>. Tag <code>downloaded</code> will, though (but will also not contain the
installed package).</p>
<h2 id="the-debugger">The Debugger</h2>
<p><a href="../user-guide/verbs/#debug">debug</a> is a really powerful tool for
establishing a breakpoint in your build plan where you can investigate
your container.</p>
<p>Just add a line:</p>
<pre><code class="ruby">debug
</code></pre>

<p>And as soon as it is reached you will see a shell appear in your
console.</p>
<h2 id="verb-properties">Verb Properties</h2>
<p><a href="../user-guide/verbs/#copy">copy</a>, <a href="../user-guide/verbs/#run">run</a>, and
other support properties to modify their behavior. You should check out
what you can do in the docs, but here are a few examples.</p>
<pre><code class="ruby"># `output: false` runs vim without attaching to the TTY, allowing you to run this
# command in a logging environment as well as a terminal one
run &quot;vim +PluginInstall -c 'set nomore' +qall&quot;, output: false

# `ignore_list` takes an array of string patterns to ignore from the
# file list.
copy &quot;*&quot;, &quot;.&quot;, ignore_list: %w[foo bar]
</code></pre>

<h2 id="experiment-with-the-repl">Experiment with the REPL</h2>
<p>The REPL is a line interpreter that immediately gives you feedback on
any given statement, allowing you to build an image interactively.</p>
<p>Works great with <code>debug</code>!</p>
<p>Launch with <code>box repl</code>.</p>
<h2 id="parallel-building">Parallel Building</h2>
<p><code>box multi</code> can build several plans at once. Just supply multiple
filenames!</p>
<p>Multi-builds do not return run output and build in parallel, so there
will be a lot of output in many cases.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>